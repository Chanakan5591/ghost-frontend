---
import Layout from '../../layouts/Layout.astro';
import { ghostClient } from '../../lib/ghost';

export async function getStaticPaths() {
    const posts = await ghostClient.posts.browse({
        limit: 'all',
        include: ['tags', 'authors']
    }).catch(err => {
        console.error(err);
        return [];
    });

    return posts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

const { post } = Astro.props;

const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
};
---

<Layout title={post.title}>
    <main class="min-h-screen w-full bg-off-white text-primary">
        <div class="max-w-[1000px] mx-auto border-x border-primary bg-off-white min-h-screen">
            
            <!-- Navigation -->
            <nav class="border-b border-primary px-6 py-4 flex justify-between items-center sticky top-0 bg-off-white/95 backdrop-blur z-50">
                <a href="/" class="text-sm font-bold uppercase tracking-widest hover:text-accent-blue transition-colors">
                    ← Back to Edition
                </a>
                <span class="font-serif italic text-primary/60">{post.primary_tag?.name || 'Editorial'}</span>
            </nav>

            <article>
                <!-- Article Header -->
                <header class="px-6 py-12 md:py-20 border-b border-primary text-center">
                    <div class="mb-6 flex justify-center gap-4 text-xs uppercase tracking-widest text-primary/60">
                        <span>{formatDate(post.published_at || new Date().toISOString())}</span>
                        <span>•</span>
                        <span>{post.reading_time} min read</span>
                    </div>
                    
                    <h1 class="font-headline text-5xl md:text-7xl leading-[0.9] mb-8 max-w-4xl mx-auto">
                        {post.title}
                    </h1>

                    {post.custom_excerpt && (
                        <p class="font-serif text-xl md:text-2xl italic text-primary/80 max-w-2xl mx-auto leading-relaxed">
                            {post.custom_excerpt}
                        </p>
                    )}
                </header>

                <!-- Feature Image -->
                {post.feature_image && (
                    <div class="border-b border-primary">
                        <img 
                            src={post.feature_image} 
                            alt={post.title}
                            class="w-full h-auto max-h-[80vh] object-cover transition-all duration-700"
                        />
                        {post.feature_image_caption && (
                            <div class="px-4 py-2 text-xs text-center border-t border-primary/20 text-primary/60 font-mono" set:html={post.feature_image_caption}></div>
                        )}
                    </div>
                )}

                <!-- Content -->
                <div class="px-6 py-12 md:py-20">
                    <div class="prose prose-lg font-serif max-w-2xl mx-auto 
                        prose-headings:font-headline prose-headings:font-bold prose-headings:text-primary prose-headings:tracking-tight
                        prose-h1:text-4xl md:prose-h1:text-5xl prose-h1:mb-8
                        prose-h2:text-3xl md:prose-h2:text-4xl prose-h2:mt-16 prose-h2:mb-6 prose-h2:border-b prose-h2:border-primary/10 prose-h2:pb-4
                        prose-h3:text-2xl md:prose-h3:text-3xl prose-h3:mt-12 prose-h3:mb-4
                        prose-p:text-primary/90 prose-p:leading-relaxed prose-p:text-lg md:prose-p:text-xl prose-p:mb-6
                        prose-a:text-accent-blue prose-a:no-underline hover:prose-a:underline prose-a:font-medium
                        prose-blockquote:border-l-4 prose-blockquote:border-accent-orange prose-blockquote:pl-6 prose-blockquote:italic prose-blockquote:text-2xl prose-blockquote:font-serif prose-blockquote:text-primary/80 prose-blockquote:my-10 prose-blockquote:bg-primary/5 prose-blockquote:py-4 prose-blockquote:pr-4 prose-blockquote:rounded-r-lg
                        prose-img:transition-all prose-img:duration-500 prose-img:rounded-lg prose-img:shadow-md prose-img:my-10
                        prose-hr:border-primary/20 prose-hr:my-12 prose-hr:border-t-2 prose-hr:w-24 prose-hr:mx-auto
                        prose-strong:font-bold prose-strong:text-primary
                        [&_iframe]:w-full [&_iframe]:aspect-video [&_iframe]:rounded-lg [&_iframe]:shadow-md [&_iframe]:my-10
                        [&>p:first-of-type::first-letter]:float-left [&>p:first-of-type::first-letter]:text-7xl [&>p:first-of-type::first-letter]:leading-[0.7] [&>p:first-of-type::first-letter]:font-bold [&>p:first-of-type::first-letter]:font-headline [&>p:first-of-type::first-letter]:text-accent-orange [&>p:first-of-type::first-letter]:mr-3 [&>p:first-of-type::first-letter]:mt-3">
                        <Fragment set:html={post.html} />
                    </div>
                </div>

                <!-- Footer -->
                <footer class="border-t border-primary px-6 py-12 text-center">
                    <div class="mb-8">
                        <p class="text-xs uppercase tracking-widest text-primary/60 mb-2">Written by</p>
                        <p class="font-serif text-xl italic">{post.primary_author?.name}</p>
                    </div>
                </footer>
            </article>
        </div>
    </main>
</Layout>
