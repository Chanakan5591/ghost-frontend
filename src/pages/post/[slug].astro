---
import Layout from '../../layouts/Layout.astro';
import { ghostClient } from '../../lib/ghost';

export async function getStaticPaths() {
    const posts = await ghostClient.posts.browse({
        limit: 'all',
        include: ['tags', 'authors']
    }).catch(err => {
        console.error(err);
        return [];
    });

    return posts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

const { post } = Astro.props;

const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
};
---

<Layout 
    title={post.title}
    description={post.custom_excerpt || post.excerpt}
    image={post.feature_image}
    type="article"
    publishedTime={post.published_at}
    authors={post.authors?.map(author => author.name) || []}
>
    <main class="min-h-screen w-full bg-off-white text-primary">
        <div class="max-w-[1200px] mx-auto border-x border-primary bg-off-white min-h-screen">
            
            <!-- Navigation -->
            <nav class="border-b border-primary px-6 py-4 flex justify-between items-center sticky top-0 bg-off-white/95 backdrop-blur z-50">
                <a href="/" class="text-xs font-bold uppercase tracking-widest hover:text-accent-blue transition-colors flex items-center gap-2">
                    <span>←</span> Back to Edition
                </a>
                <span class="font-serif italic text-primary/60 lowercase text-lg">{post.primary_tag?.name || 'editorial'}</span>
            </nav>

            <article>
                <!-- Article Header -->
                <header class="px-6 py-16 md:py-24 border-b border-off-white/20 text-center bg-primary text-off-white">
                    <div class="mb-8 flex justify-center gap-3 text-[0.65rem] uppercase tracking-[0.2em] text-off-white/90 font-medium">
                        <span>{formatDate(post.published_at || new Date().toISOString())}</span>
                        <span>•</span>
                        <span>{post.reading_time} min read</span>
                    </div>
                    
                    <h1 class="font-headline text-5xl md:text-7xl lg:text-8xl leading-[0.9] mb-8 max-w-5xl mx-auto text-off-white">
                        {post.title}
                    </h1>

                    {post.custom_excerpt && (
                        <p class="font-serif text-xl md:text-2xl italic text-off-white/80 max-w-2xl mx-auto leading-relaxed">
                            {post.custom_excerpt}
                        </p>
                    )}
                </header>

                <!-- Feature Image -->
                {post.feature_image && (
                    <div class="border-b border-primary bg-primary">
                        <div class="w-full overflow-hidden">
                            <img 
                                src={post.feature_image} 
                                alt={post.title}
                                class="w-full h-auto object-cover"
                            />
                        </div>
                        {post.feature_image_caption && (
                            <div class="px-4 py-3 text-[0.65rem] uppercase tracking-widest text-center border-t border-off-white/20 text-off-white/90 font-mono bg-primary" set:html={post.feature_image_caption}></div>
                        )}
                    </div>
                )}

                <!-- Content -->
                <div class="px-6 py-12 md:py-20 bg-off-white">
                    <div class="prose prose-lg md:prose-xl font-serif max-w-[680px] mx-auto 
                        prose-headings:font-headline prose-headings:font-bold prose-headings:text-primary prose-headings:tracking-tight prose-headings:leading-none
                        prose-h1:text-4xl md:prose-h1:text-5xl prose-h1:mb-8
                        prose-h2:text-3xl md:prose-h2:text-4xl prose-h2:mt-16 prose-h2:mb-8
                        prose-h3:text-2xl md:prose-h3:text-3xl prose-h3:mt-12 prose-h3:mb-6
                        prose-p:text-primary/85 prose-p:leading-[1.75] prose-p:mb-8 prose-p:text-[1.1rem] md:prose-p:text-[1.25rem]
                        prose-a:text-accent-blue prose-a:no-underline hover:prose-a:underline prose-a:font-medium prose-a:decoration-1 prose-a:underline-offset-4
                        prose-blockquote:border-l-2 prose-blockquote:border-accent-orange prose-blockquote:pl-8 prose-blockquote:italic prose-blockquote:text-2xl md:prose-blockquote:text-3xl prose-blockquote:font-serif prose-blockquote:text-primary/80 prose-blockquote:my-12 prose-blockquote:not-italic
                        prose-img:rounded-sm prose-img:my-12 prose-img:w-full
                        prose-hr:border-primary/20 prose-hr:my-16 prose-hr:border-t prose-hr:w-full
                        prose-strong:font-bold prose-strong:text-primary
                        prose-code:font-mono prose-code:text-sm prose-code:bg-primary/5 prose-code:px-1 prose-code:py-0.5 prose-code:rounded
                        [&_iframe]:w-full [&_iframe]:aspect-video [&_iframe]:my-12
                        [&>p:first-of-type::first-letter]:float-left [&>p:first-of-type::first-letter]:text-7xl [&>p:first-of-type::first-letter]:leading-[0.7] [&>p:first-of-type::first-letter]:font-bold [&>p:first-of-type::first-letter]:font-headline [&>p:first-of-type::first-letter]:text-accent-orange [&>p:first-of-type::first-letter]:mr-3 [&>p:first-of-type::first-letter]:mt-3">
                        <Fragment set:html={post.html} />
                    </div>
                </div>

                <!-- Footer -->
                <footer class="border-t border-off-white/20 px-6 py-12 text-center bg-primary text-off-white">
                    <div class="mb-8">
                        <p class="text-xs uppercase tracking-widest text-off-white/60 mb-2">Written by</p>
                        <p class="font-serif text-xl italic">{post.primary_author?.name}</p>
                    </div>
                </footer>
            </article>
        </div>
    </main>
</Layout>
