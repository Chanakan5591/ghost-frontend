---
import Layout from '../layouts/Layout.astro';
import { ghostClient } from '../lib/ghost';

import Newsletter from '../components/Newsletter.svelte';

const posts = await ghostClient.posts.browse({
    limit: 'all',
    include: ['tags', 'authors']
}).catch(err => {
    console.error(err);
    return [];
});

const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
};

const getYear = (dateString: string) => {
    return new Date(dateString).getFullYear();
}

const hoverColors = [
    'group-hover:text-accent-blue',
    'group-hover:text-accent-orange',
    'group-hover:text-accent-green',
    'group-hover:text-accent-purple'
];
---

<Layout 
    title="ChanakanLabs Editorial"
    description="A curated collection of stories on technology, design, and culture."
    type="website"
>
	<main class="min-h-screen w-full bg-off-white text-primary">
		<div class="max-w-[1600px] mx-auto border-x border-primary">
			
			<!-- Header Section (Newspaper Masthead) -->
			<header class="border-b border-primary bg-off-white">
				<!-- Meta Bar -->
				<div class="flex justify-between items-center px-4 py-2 border-b border-primary text-xs uppercase tracking-widest font-medium">
					<span>Vol. 01</span>
					<span class="hidden md:inline">The Editorial</span>
					<span>{new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</span>
				</div>

				<!-- Masthead Title -->
				<div class="py-16 md:py-24 px-4 text-center border-b border-primary relative overflow-hidden">
					<h1 class="font-headline text-[12vw] md:text-[10rem] leading-[0.8] text-primary flex justify-center select-none">
						CHANAKANLABS
					</h1>
					<div class="mt-6 flex justify-center items-center gap-4">
						<span class="h-px w-12 bg-primary hidden md:block"></span>
						<p class="text-lg md:text-2xl font-serif italic text-primary/80">Editorial & Stories</p>
						<span class="h-px w-12 bg-primary hidden md:block"></span>
					</div>
				</div>
			</header>

            <!-- Posts Section -->
            <div class="flex flex-col">
                {posts.map((post, index) => {
                    const isDark = index % 2 === 0;
                    const bgClass = isDark ? 'bg-primary' : 'bg-off-white';
                    const textClass = isDark ? 'text-off-white' : 'text-primary';
                    const borderClass = isDark ? 'border-off-white/20' : 'border-primary';
                    const metaClass = isDark ? 'text-off-white/60' : 'text-primary/60';
                    const serifClass = isDark ? 'text-off-white/85' : 'text-primary/85';
                    const hoverColor = hoverColors[index % hoverColors.length];

                    return (
                        <a href={`/post/${post.slug}`} class="group block">
                            <section class={`border-b ${borderClass} ${bgClass} ${textClass} transition-colors duration-500`}>
                                <div class="grid grid-cols-1 lg:grid-cols-12">
                                
                                <!-- Text Section -->
                                <div class={`lg:col-span-7 p-8 md:p-12 lg:p-16 flex flex-col justify-between ${index % 2 === 1 ? 'lg:order-2 lg:border-l' : 'lg:order-1 lg:border-r'} ${borderClass}`}>
                                    
                                    <div class="space-y-8">
                                    <!-- Meta -->
                                    <div class="flex items-start justify-between gap-4">
                                        <div class={`text-xs md:text-sm uppercase tracking-[0.24em] font-medium ${metaClass}`}>
                                        {post.primary_tag ? post.primary_tag.name : 'Editorial'} / Collection
                                        </div>
                                        <div class={`text-xs md:text-sm uppercase tracking-[0.18em] font-medium opacity-70`}>
                                        {post.published_at ? getYear(post.published_at) : '2025'} · Index
                                        </div>
                                    </div>

                                    <!-- Main Content -->
                                    <div class="space-y-6">
                                        <h3 class={`font-headline text-4xl md:text-6xl lg:text-7xl leading-[0.9] ${hoverColor} transition-colors duration-300`}>
                                        {post.title}
                                        </h3>
                                        <p class={`font-serif text-xl md:text-2xl leading-relaxed ${serifClass} max-w-2xl line-clamp-3`}>
                                        {post.excerpt}
                                        </p>
                                    </div>
                                    </div>

                                    <!-- Footer Columns -->
                                    <div class={`grid grid-cols-2 gap-4 md:gap-8 text-xs md:text-sm uppercase tracking-widest font-medium mt-12 pt-8 border-t ${isDark ? 'border-off-white/30' : 'border-primary/30'}`}>
                                    <div>
                                        <div class="opacity-60 mb-2">Type</div>
                                        <div>Article</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="opacity-60 mb-2">Action</div>
                                        <span class={`group-hover:underline decoration-1 underline-offset-4 ${hoverColor}`}>
                                        Read Story ↗
                                        </span>
                                    </div>
                                    </div>
                                </div>

                                <!-- Image Section -->
                                <div class={`lg:col-span-5 relative min-h-[40vh] lg:min-h-full overflow-hidden ${index % 2 === 1 ? 'lg:order-1' : 'lg:order-2'}`}>
                                    <div class={`absolute inset-0 ${isDark ? 'bg-primary/20' : 'bg-primary/5'} group-hover:bg-transparent transition-colors duration-500 z-10`}></div>
                                    {post.feature_image && (
                                        <img 
                                            src={post.feature_image} 
                                            alt={post.title}
                                            class="absolute inset-0 w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700 group-hover:scale-105"
                                        />
                                    )}
                                    {!post.feature_image && (
                                        <div class={`absolute inset-0 w-full h-full ${isDark ? 'bg-primary' : 'bg-off-white'} flex items-center justify-center`}>
                                            <span class="text-primary/20 font-headline text-4xl">No Image</span>
                                        </div>
                                    )}
                                </div>

                                </div>
                            </section>
                        </a>
                    );
                })}
            </div>
            
            {posts.length === 0 && (
                <div class="p-12 text-center font-serif text-xl border-b border-primary">
                    <p>No posts found. Check your Ghost API configuration.</p>
                </div>
            )}
            
            <Newsletter client:visible />
		</div>
	</main>
</Layout>
